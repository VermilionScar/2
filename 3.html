<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>test</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --accent-color: #e74c3c;
        --dark-color: #2c3e50;
        --light-color: #ecf0f1;
        --text-color: #333;
        --border-radius: 12px;
        --shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 30px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
      }

      header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #3498db, #2ecc71, #3498db);
        z-index: -1;
        opacity: 0.9;
      }

      h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .subtitle {
        font-size: 1.3rem;
        opacity: 0.9;
        max-width: 800px;
        margin: 0 auto;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
        background: white;
        padding: 25px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
      }

      .search-container {
        display: flex;
        flex: 1;
        min-width: 300px;
        position: relative;
        border-radius: 50px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .search-container input {
        width: 100%;
        padding: 15px 25px;
        border: none;
        font-size: 1.1rem;
        background: #f8f9fa;
        transition: var(--transition);
      }

      .search-container input:focus {
        outline: none;
        background: white;
      }

      .search-container button {
        padding: 0 25px;
        background: var(--primary-color);
        color: white;
        border: none;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: var(--transition);
      }

      .search-container button:hover {
        background: #2980b9;
      }

      .categories {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        flex: 2;
      }

      .category-btn {
        padding: 10px 20px;
        background: var(--light-color);
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .category-btn:hover {
        background: #ddd;
        transform: translateY(-3px);
      }

      .category-btn.active {
        background: var(--primary-color);
        color: white;
        box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
      }

      .gallery-container {
        position: relative;
        min-height: 600px;
      }

      .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
      }

      .image-card {
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
        cursor: pointer;
      }

      .image-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }

      .image-card:hover .image-category {
        transform: translateY(0);
        opacity: 1;
      }

      .image-placeholder {
        background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        width: 100%;
        height: 220px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-size: 15px;
        position: relative;
      }

      .image-category {
        position: absolute;
        top: 12px;
        right: 12px;
        background: rgba(52, 152, 219, 0.9);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        transform: translateY(-15px);
        opacity: 0;
        transition: var(--transition);
        z-index: 2;
      }

      .image-info {
        padding: 18px;
      }

      .image-title {
        font-weight: 700;
        margin-bottom: 8px;
        font-size: 1.15rem;
        color: var(--dark-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .image-id {
        font-size: 0.9rem;
        color: #7f8c8d;
        background: #f1f2f6;
        padding: 3px 8px;
        border-radius: 4px;
      }

      .image-description {
        color: #666;
        font-size: 0.95rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.6;
      }

      .pagination {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      .page-btn {
        padding: 10px 18px;
        background: white;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
        min-width: 45px;
        text-align: center;
        font-weight: 600;
      }

      .page-btn:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .page-btn.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
      }

      .stats {
        text-align: center;
        margin-top: 20px;
        color: #666;
        font-size: 1rem;
        padding: 15px;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
        background: #f8f9fa;
        padding: 8px 15px;
        border-radius: 30px;
      }

      .loading {
        text-align: center;
        padding: 30px;
        color: #666;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .loader {
        width: 45px;
        height: 45px;
        border: 5px solid rgba(52, 152, 219, 0.2);
        border-top: 5px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      #sentinel {
        height: 1px;
        width: 100%;
        margin: 20px 0;
      }

      /* 图片详情模态框样式 */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .modal.active {
        display: flex;
        opacity: 1;
      }

      .modal-content {
        background: white;
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 900px;
        max-height: 90vh;
        overflow: auto;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        transform: translateY(20px);
        transition: transform 0.4s ease;
      }

      .modal.active .modal-content {
        transform: translateY(0);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: var(--primary-color);
        color: white;
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 600;
      }

      .close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.8rem;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
      }

      .close-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .modal-body {
        padding: 30px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .modal-image {
        background: #f8f9fa;
        border-radius: var(--border-radius);
        height: 350px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: #666;
      }

      .modal-details {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .detail-item {
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .detail-label {
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 8px;
        font-size: 1.1rem;
      }

      .detail-value {
        color: #555;
        line-height: 1.7;
      }

      .modal-footer {
        padding: 20px;
        display: flex;
        justify-content: flex-end;
        background: #f8f9fa;
        border-top: 1px solid #eee;
      }

      .action-btn {
        padding: 12px 25px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .download-btn {
        background: var(--secondary-color);
        color: white;
      }

      .download-btn:hover {
        background: #27ae60;
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(46, 204, 113, 0.3);
      }

      @media (max-width: 992px) {
        .modal-body {
          grid-template-columns: 1fr;
        }

        .modal-image {
          height: 300px;
        }
      }

      @media (max-width: 768px) {
        .gallery {
          grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        }

        .controls {
          flex-direction: column;
        }

        .search-container {
          min-width: 100%;
        }

        header {
          padding: 25px 15px;
        }

        h1 {
          font-size: 2.3rem;
        }

        .modal-content {
          width: 95%;
        }
      }

      @media (max-width: 480px) {
        .gallery {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 2rem;
        }

        .category-btn {
          padding: 8px 15px;
          font-size: 0.9rem;
        }

        .stat-item {
          font-size: 0.9rem;
        }

        .modal-header {
          padding: 15px;
        }

        .modal-title {
          font-size: 1.3rem;
        }

        .modal-body {
          padding: 20px;
          gap: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1><i class="fas fa-images"></i> 图片</h1>
        <p class="subtitle">图片</p>
      </header>

      <div class="controls">
        <div class="search-container">
          <input
            type="text"
            id="searchInput"
            placeholder="输入关键词搜索图片..."
          />
          <button id="searchBtn"><i class="fas fa-search"></i> 搜索</button>
        </div>

        <div class="categories">
          <button class="category-btn active" data-category="all">
            <i class="fas fa-layer-group"></i> 全部
          </button>
          <button class="category-btn" data-category="nature">
            <i class="fas fa-mountain"></i> 1
          </button>
          <button class="category-btn" data-category="city">
            <i class="fas fa-city"></i> 2
          </button>
          <button class="category-btn" data-category="people">
            <i class="fas fa-user-friends"></i> 3
          </button>
          <button class="category-btn" data-category="animals">
            <i class="fas fa-paw"></i> 4
          </button>
          <button class="category-btn" data-category="food">
            <i class="fas fa-utensils"></i> 5
          </button>
        </div>
      </div>

      <div class="gallery-container">
        <div class="gallery" id="imageGallery">
          <!-- 图片将通过JavaScript动态加载 -->
        </div>

        <div id="sentinel"></div>

        <div class="loading" id="loadingIndicator">
          <div class="loader"></div>
          正在加载图片，请稍候...
        </div>
      </div>

      <div class="pagination" id="pagination">
        <!-- 分页将通过JavaScript动态生成 -->
      </div>

      <div class="stats" id="stats">
        <div class="stat-item">
          <i class="fas fa-images"></i>
          <span>总图片数: <span id="totalImages">10,000</span></span>
        </div>
        <div class="stat-item">
          <i class="fas fa-filter"></i>
          <span>当前显示: <span id="filteredImages">0</span> 张</span>
        </div>
        <div class="stat-item">
          <i class="fas fa-layer-group"></i>
          <span>当前分类: <span id="currentCategory">全部</span></span>
        </div>
        <div class="stat-item">
          <i class="fas fa-sync-alt"></i>
          <span
            >滚动优化:
            <span style="color: var(--secondary-color)">已启用</span></span
          >
        </div>
      </div>
    </div>

    <!-- 图片详情模态框 -->
    <div class="modal" id="imageModal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title" id="modalTitle">图片详情</div>
          <button class="close-btn" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="modal-image" id="modalImage">
            <!-- 图片将动态加载 -->
          </div>
          <div class="modal-details">
            <div class="detail-item">
              <div class="detail-label">图片ID</div>
              <div class="detail-value" id="detailId">#0000</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">分类</div>
              <div class="detail-value" id="detailCategory">未分类</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">尺寸</div>
              <div class="detail-value" id="detailDimensions">0 × 0 像素</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">上传日期</div>
              <div class="detail-value" id="detailDate">2023-01-01</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">详细描述</div>
              <div class="detail-value" id="detailDescription">暂无描述</div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="action-btn download-btn">
            <i class="fas fa-download"></i> 下载图片
          </button>
        </div>
      </div>
    </div>

    <script>
      // 图片数据模拟（实际项目中应从服务器获取）
      const generateImageData = () => {
        const categories = {
          nature: { name: "a", icon: "mountain" },
          city: { name: "b", icon: "city" },
          people: { name: "c", icon: "user-friends" },
          animals: { name: "d", icon: "paw" },
          food: { name: "e", icon: "utensils" },
        };

        const titles = [
          "a",
          "b",
          "c",
          "d",
          "e",
          "f",
          "g",
          "h",
          "i",
          "j",
          "k",
          "l",
        ];

        const descriptions = [
          "1。",
          "2。",
          "3。",
          "4。",
          "5。",
          "6。",
          "7。",
          "8",
          "9",
          "10。",
          "11",
          "12",
        ];

        const data = [];
        const currentDate = new Date();

        for (let i = 1; i <= 10000; i++) {
          const catKeys = Object.keys(categories);
          const randomCat = catKeys[Math.floor(Math.random() * catKeys.length)];
          const randomTitle = titles[Math.floor(Math.random() * titles.length)];
          const randomDesc =
            descriptions[Math.floor(Math.random() * descriptions.length)];

          // 随机生成上传日期（最近3年内）
          const uploadDate = new Date(currentDate);
          uploadDate.setMonth(
            uploadDate.getMonth() - Math.floor(Math.random() * 36)
          );

          data.push({
            id: i,
            title: `${randomTitle} #${i}`,
            description: `${randomDesc} 这是第 ${i} 张图片。`,
            category: randomCat,
            categoryName: categories[randomCat].name,
            width: 800 + Math.floor(Math.random() * 1200),
            height: 600 + Math.floor(Math.random() * 900),
            uploadDate: uploadDate.toISOString().split("T")[0],
          });
        }
        return data;
      };

      // 全局变量
      const IMAGES_PER_PAGE = 24;
      let currentPage = 1;
      let currentCategory = "all";
      let currentCategoryName = "全部";
      let currentSearch = "";
      let allImages = generateImageData();
      let filteredImages = [...allImages];
      let isLoading = false;

      // DOM元素
      const galleryElement = document.getElementById("imageGallery");
      const paginationElement = document.getElementById("pagination");
      const statsElement = document.getElementById("stats");
      const totalImagesElement = document.getElementById("totalImages");
      const filteredImagesElement = document.getElementById("filteredImages");
      const currentCategoryElement = document.getElementById("currentCategory");
      const loadingElement = document.getElementById("loadingIndicator");
      const searchInput = document.getElementById("searchInput");
      const searchBtn = document.getElementById("searchBtn");
      const sentinelElement = document.getElementById("sentinel");
      const imageModal = document.getElementById("imageModal");
      const closeModal = document.getElementById("closeModal");
      const modalTitle = document.getElementById("modalTitle");
      const modalImage = document.getElementById("modalImage");
      const detailId = document.getElementById("detailId");
      const detailCategory = document.getElementById("detailCategory");
      const detailDimensions = document.getElementById("detailDimensions");
      const detailDate = document.getElementById("detailDate");
      const detailDescription = document.getElementById("detailDescription");

      // 初始化
      document.addEventListener("DOMContentLoaded", () => {
        totalImagesElement.textContent = allImages.length.toLocaleString();
        renderGallery();
        renderPagination();
        setupEventListeners();
        setupIntersectionObserver();
      });

      // 设置事件监听器
      function setupEventListeners() {
        // 分类按钮
        document.querySelectorAll(".category-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".category-btn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            currentCategory = btn.dataset.category;
            currentCategoryName =
              currentCategory === "all" ? "全部" : btn.textContent.trim();
            currentPage = 1;
            filterImages();
            renderGallery();
            renderPagination();
            updateStats();
          });
        });

        // 搜索按钮
        searchBtn.addEventListener("click", performSearch);

        // 回车键搜索
        searchInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            performSearch();
          }
        });

        // 输入防抖搜索
        let searchTimeout;
        searchInput.addEventListener("input", (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            currentSearch = e.target.value.toLowerCase();
            currentPage = 1;
            filterImages();
            renderGallery();
            renderPagination();
            updateStats();
          }, 400);
        });

        // 关闭模态框
        closeModal.addEventListener("click", () => {
          imageModal.classList.remove("active");
        });

        // 点击模态框外部关闭
        imageModal.addEventListener("click", (e) => {
          if (e.target === imageModal) {
            imageModal.classList.remove("active");
          }
        });
      }

      // 执行搜索
      function performSearch() {
        currentSearch = searchInput.value.toLowerCase();
        currentPage = 1;
        filterImages();
        renderGallery();
        renderPagination();
        updateStats();
      }

      // 设置 Intersection Observer
      function setupIntersectionObserver() {
        const observer = new IntersectionObserver(
          (entries) => {
            if (entries[0].isIntersecting && !isLoading) {
              if (currentPage * IMAGES_PER_PAGE < filteredImages.length) {
                currentPage++;
                renderGallery();
                renderPagination();
                updateStats();
              }
            }
          },
          {
            rootMargin: "200px",
            threshold: 0.01,
          }
        );

        observer.observe(sentinelElement);
      }

      // 过滤图片
      function filterImages() {
        filteredImages = allImages.filter((img) => {
          const matchesCategory =
            currentCategory === "all" || img.category === currentCategory;
          const matchesSearch =
            img.title.toLowerCase().includes(currentSearch) ||
            img.description.toLowerCase().includes(currentSearch);
          return matchesCategory && matchesSearch;
        });

        updateStats();
      }

      // 更新统计信息
      function updateStats() {
        filteredImagesElement.textContent =
          filteredImages.length.toLocaleString();
        currentCategoryElement.textContent = currentCategoryName;
      }

      // 渲染图片网格
      function renderGallery() {
        if (isLoading) return;

        isLoading = true;
        loadingElement.style.display = "flex";

        // 使用setTimeout模拟加载延迟
        setTimeout(() => {
          const startIndex = (currentPage - 1) * IMAGES_PER_PAGE;
          const endIndex = Math.min(
            startIndex + IMAGES_PER_PAGE,
            filteredImages.length
          );
          const pageImages = filteredImages.slice(startIndex, endIndex);

          // 如果是第一页，清空现有内容
          if (currentPage === 1) {
            galleryElement.innerHTML = "";
          }

          // 添加新图片
          pageImages.forEach((img) => {
            const card = document.createElement("div");
            card.className = "image-card";
            card.dataset.id = img.id;

            // 在实际项目中，这里应该使用真实的图片URL
            card.innerHTML = `
                        <div class="image-placeholder">
                            <div class="image-category">${img.categoryName}</div>
                            图片 ${img.id} (${img.width}×${img.height})
                        </div>
                        <div class="image-info">
                            <div class="image-title">
                                ${img.title}
                                <span class="image-id">#${img.id}</span>
                            </div>
                            <div class="image-description">${img.description}</div>
                        </div>
                    `;

            // 添加点击事件
            card.addEventListener("click", () => showImageDetail(img));

            galleryElement.appendChild(card);
          });

          isLoading = false;
          loadingElement.style.display = "none";
        }, 300);
      }

      // 显示图片详情
      function showImageDetail(img) {
        modalTitle.textContent = img.title;
        modalImage.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 5rem; color: #3498db; margin-bottom: 20px;">
                        <i class="fas fa-image"></i>
                    </div>
                    <h3>图片预览</h3>
                    <p>ID: ${img.id} | ${img.width}×${img.height} 像素</p>
                </div>
            `;
        detailId.textContent = `#${img.id}`;
        detailCategory.textContent = img.categoryName;
        detailDimensions.textContent = `${img.width} × ${img.height} 像素`;
        detailDate.textContent = img.uploadDate;
        detailDescription.textContent = img.description;

        imageModal.classList.add("active");
      }

      // 渲染分页控件
      function renderPagination() {
        const totalPages = Math.ceil(filteredImages.length / IMAGES_PER_PAGE);

        // 清空现有分页
        paginationElement.innerHTML = "";

        // 添加分页按钮
        for (let i = 1; i <= totalPages; i++) {
          if (
            i === 1 ||
            i === totalPages ||
            (i >= currentPage - 2 && i <= currentPage + 2)
          ) {
            const btn = document.createElement("button");
            btn.className = `page-btn ${i === currentPage ? "active" : ""}`;
            btn.textContent = i;
            btn.addEventListener("click", () => {
              currentPage = i;
              renderGallery();
              renderPagination();
              window.scrollTo({ top: 0, behavior: "smooth" });
            });

            paginationElement.appendChild(btn);
          } else if (i === currentPage - 3 || i === currentPage + 3) {
            const ellipsis = document.createElement("span");
            ellipsis.textContent = "...";
            ellipsis.style.padding = "10px";
            ellipsis.style.display = "flex";
            ellipsis.style.alignItems = "center";
            paginationElement.appendChild(ellipsis);
          }
        }
      }
    </script>
  </body>
</html>
